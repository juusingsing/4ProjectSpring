<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="back.mapper.plant.PlantMapper"> 

	<!-- 식물 일조량 개별 수정-->
	<update id="updatePlantSunlightLogs" parameterType="back.model.plant.Plant">
    	update Plant
    	SET
    		PLANT_SUNLIGHTING_STATUS = #{sunlightStatus, jdbcType=VARCHAR},
    		PLANT_SUNLIGHTING_MEMO = #{sunlightMemo},
    		UPDATE_ID=#{updateId},
    		UPDATE_DT=SYSDATE
    	WHERE PLANT_SUNLIGHTING_ID=#{plantSunlightingId}
    </update>

        
	<!-- 식물 일조량 개별 삭제-->
	<delete id="deletePlantSunlightLogs" parameterType="back.model.plant.Plant">
	    UPDATE PLANT_SUNLIGHTING
	    SET DEL_YN='Y',
	    	UPDATE_ID=#{updateId},
    		UPDATE_DT=SYSDATE
	    WHERE PLANT_SUNLIGHTING_ID = #{plantSunlightingId}
	</delete>

	<!-- 식물 일조량 조회 -->
	<select id="findByPlantId" resultType="back.model.plant.Plant">
        SELECT PLANT_SUNLIGHTING_ID AS plantSunlightingId,
               PLANT_ID AS plantId,
               PLANT_SUNLIGHTING_STATUS AS sunlightStatus,
               PLANT_SUNLIGHTING_MEMO AS sunlightMemo,
               TO_CHAR(CREATE_DT, 'YYYY.MM.DD') AS createDt
        FROM PLANT_SUNLIGHTING
        WHERE PLANT_ID = #{plantId}
        AND DEL_YN = 'N' ORDER BY CREATE_DT DESC
    </select>
	
	<select id="selectPlantCheck" parameterType="int" resultType="map">
        SELECT plant_name AS plantName,
               plant_purchase_date AS plantPurchaseDate
        FROM plant
        WHERE plant_id = #{plantId}
    </select>
	

	<select id="selectPlantById" parameterType="string" resultType="back.model.plant.Plant">
	    SELECT
	        PLANT_ID,
	        USERS_ID,
	        FILE_ID,
	        PLANT_NAME,
	        PLANT_TYPE,
	        PLANT_PURCHASE_DATE,
	        PLANT_SUN_PREFERENCE,
	        PLANT_GROW_STATUS,
	        CREATE_ID,
	        UPDATE_ID,
	        CREATE_DT,
	        UPDATE_DT,
	        DEL_YN
	    FROM PLANT
	    WHERE PLANT_ID = #{plantId}
	</select>


    <!-- 식물 등록 -->
    <insert id="create" parameterType="back.model.plant.Plant">   
    <selectKey keyProperty="plantId" resultType="int" order="BEFORE">
	    SELECT PLANT_SEQ.NEXTVAL FROM DUAL
	</selectKey>

        INSERT INTO PLANT (
            PLANT_ID,
            USERS_ID,
            FILE_ID,
            PLANT_NAME,
            PLANT_TYPE,
            PLANT_PURCHASE_DATE,
            PLANT_SUN_PREFERENCE,
            PLANT_GROW_STATUS,
            CREATE_ID,
            UPDATE_ID,
            CREATE_DT,
            UPDATE_DT,
            DEL_YN
        ) VALUES (
            #{plantId},
            #{usersId},
            #{fileId},
            #{plantName},
            #{plantType},
            #{plantPurchaseDate, jdbcType=DATE},
            #{plantSunPreference},
            #{plantGrowStatus},
            #{createId, jdbcType=VARCHAR},
            #{updateId, jdbcType=VARCHAR},
            SYSDATE,
            SYSDATE,
            'N'
        )

    </insert>
    
	<!-- 저장 -->
<insert id="saveSunlightInfo" parameterType="back.model.plant.Plant" useGeneratedKeys="true" keyProperty="plantSunlightingId" keyColumn="PLANT_SUNLIGHTING_ID">
    <selectKey keyProperty="plantSunlightingId" resultType="int" order="BEFORE">
        SELECT PLANT_SUNLIGHTING_SEQ.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO PLANT_SUNLIGHTING (
        PLANT_SUNLIGHTING_ID,
        PLANT_ID,
        PLANT_SUNLIGHTING_STATUS,
        PLANT_SUNLIGHTING_MEMO,
        CREATE_ID,
        UPDATE_ID,
        CREATE_DT,
        UPDATE_DT,
        DEL_YN
    ) VALUES (
        #{plantSunlightingId},
        #{plantId},
        #{sunlightStatus, jdbcType=VARCHAR},
        #{sunlightMemo},
        #{createId},
        #{updateId, jdbcType=VARCHAR},
        SYSDATE,
        SYSDATE,
        'N'
    )
</insert>


    <!-- 식물 수정 -->
    <update id="update" parameterType="back.model.plant.Plant">
        UPDATE PLANT
        SET
            PLANT_NAME = #{plantName},
            PLANT_TYPE = #{plantType},
            PLANT_PURCHASE_DATE = #{plantPurchaseDate, jdbcType=DATE},
            PLANT_SUN_PREFERENCE = #{plantSunPreference},
            PLANT_GROW_STATUS = #{plantGrowStatus},
            UPDATE_ID = #{updateId, jdbcType=VARCHAR},
            UPDATE_DT = SYSDATE
        WHERE PLANT_ID = #{plantId}
    </update>

    <!-- 식물 삭제 -->
    <delete id="delete" parameterType="int">
	    DELETE FROM PLANT
	    WHERE plant_id = #{plantId}
	</delete>

</mapper>
